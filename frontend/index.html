<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Single-file React CRUD</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- React + Babel (development convenience only) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
      body { font-family: Arial, sans-serif; max-width:900px; margin:20px auto; padding:10px; }
      input, textarea { width:100%; padding:8px; margin:6px 0; box-sizing:border-box; }
      button { padding:8px 12px; margin-right:6px; }
      .item { border:1px solid #ddd; padding:8px; margin:8px 0; border-radius:6px; }
    </style>
  </head>
  <body>
    <h1>React single-file CRUD (Test)</h1>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;
      const API = 'http://localhost:5000';

      function App(){
        const [items, setItems] = useState([]);
        const [name, setName] = useState('');
        const [description, setDescription] = useState('');
        const [editing, setEditing] = useState(null);

        async function load(){
          const res = await fetch(API + '/items');
          const data = await res.json();
          setItems(data);
        }

        useEffect(()=>{ load(); }, []);

        async function createItem(e){
          e.preventDefault();
          if(!name) return alert('name required');
          const res = await fetch(API + '/items', {
            method:'POST',
            headers:{ 'Content-Type':'application/json' },
            body: JSON.stringify({ name, description })
          });
          if(res.ok){
            setName(''); setDescription('');
            load();
          } else {
            alert('create failed');
          }
        }

        async function startEdit(it){
          setEditing(it);
          setName(it.name);
          setDescription(it.description);
        }

        async function updateItem(e){
          e.preventDefault();
          const res = await fetch(API + '/items/' + editing.id, {
            method:'PUT',
            headers:{ 'Content-Type':'application/json' },
            body: JSON.stringify({ name, description })
          });
          if(res.ok){ setEditing(null); setName(''); setDescription(''); load(); }
          else alert('update failed');
        }

        async function deleteItem(id){
          if(!confirm('Delete?')) return;
          const res = await fetch(API + '/items/' + id, { method:'DELETE' });
          if(res.ok) load(); else alert('delete failed');
        }

        return (
          <div>
            <form onSubmit={editing ? updateItem : createItem}>
              <input placeholder="Name" value={name} onChange={e=>setName(e.target.value)} />
              <textarea placeholder="Description" value={description} onChange={e=>setDescription(e.target.value)} rows="3" />
              <div>
                <button type="submit">{editing ? 'Update' : 'Create'}</button>
                {editing && <button type="button" onClick={()=>{ setEditing(null); setName(''); setDescription(''); }}>Cancel</button>}
              </div>
            </form>

            <h2>Items</h2>
            {items.length === 0 && <div>No items yet</div>}
            {items.map(it => (
              <div className="item" key={it.id}>
                <strong>{it.name}</strong>
                <div style={{fontSize:'0.9em', color:'#444'}}>{it.description}</div>
                <div style={{marginTop:6}}>
                  <button onClick={()=>startEdit(it)}>Edit</button>
                  <button onClick={()=>deleteItem(it.id)}>Delete</button>
                </div>
              </div>
            ))}
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
    </script>
  </body>
</html>
